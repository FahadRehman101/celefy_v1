<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Celefy ‚Äì Celebrate Better</title>
    <meta name="description" content="Celefy is your smart celebration and birthday reminder app with filters, countdowns, and push notifications. Never miss a special day again." />
    <meta name="theme-color" content="#209CEE" />

    <link rel="icon" type="image/png" href="/icons/icon-192.png" />
    <link rel="apple-touch-icon" href="/icons/icon-192.png" />

    <link rel="manifest" href="/manifest.webmanifest" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

    <!-- OneSignal v16 SDK - FIXED VERSION -->
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    
    <!-- OneSignal v16 Loading Script - IMPROVED -->
    <script>
      console.log('üöÄ Celefy: Starting OneSignal v16 detection...');
      
      // OneSignal v16 detection with better error handling
      let checkCount = 0;
      const maxChecks = 60; // Check for 60 seconds max
      
      const checkOneSignalV16Loading = () => {
        checkCount++;
        const elapsed = Math.round((performance.now() - performance.timing.navigationStart) / 1000);
        
        console.log(`üîç OneSignal v16 check #${checkCount} (${elapsed}s elapsed):`);
        
        if (typeof window.OneSignal !== 'undefined') {
          console.log('‚úÖ OneSignal v16 SDK loaded successfully!');
          console.log('üîç OneSignal object type:', typeof window.OneSignal);
          console.log('üîç OneSignal properties:', Object.keys(window.OneSignal));
          
          // Check for v16 specific properties
          if (window.OneSignal.Slidedown || window.OneSignal.Notifications) {
            console.log('‚úÖ OneSignal v16 API detected!');
          } else if (typeof window.OneSignal.init === 'function') {
            console.log('‚úÖ OneSignal init function available');
          } else {
            console.log('‚ö†Ô∏è OneSignal loaded but structure unknown');
          }
          
          // Log version if available
          if (window.OneSignal.VERSION) {
            console.log('üì± OneSignal version:', window.OneSignal.VERSION);
          }
          
          return; // Stop checking
        }
        
        console.log(`üîç - OneSignal exists: ${typeof window.OneSignal !== 'undefined'}`);
        console.log(`üîç - Window properties: ${Object.keys(window).filter(k => k.toLowerCase().includes('onesignal')).join(', ') || 'none'}`);
        
        if (checkCount < maxChecks) {
          setTimeout(checkOneSignalV16Loading, 1000);
        } else {
          console.error('‚ùå OneSignal v16 SDK failed to load after 60 seconds!');
          console.error('üîç Final window check:', {
            hasOneSignal: 'OneSignal' in window,
            oneSignalType: typeof window.OneSignal,
            windowKeys: Object.keys(window).filter(k => k.toLowerCase().includes('signal'))
          });
        }
      };
      
      // Start checking after DOM loads
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          setTimeout(checkOneSignalV16Loading, 500);
        });
      } else {
        setTimeout(checkOneSignalV16Loading, 500);
      }
      
      // Also check when window loads
      window.addEventListener('load', () => {
        console.log('üöÄ Window loaded, doing final OneSignal v16 check...');
        if (typeof window.OneSignal !== 'undefined') {
          console.log('‚úÖ OneSignal v16 confirmed available on window load');
        } else {
          console.log('‚ùå OneSignal v16 still not available on window load');
        }
      });
    </script>
  </head>

  <body class="bg-light dark:bg-dark">
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>